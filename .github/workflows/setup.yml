name: GCP setup

on:
  workflow_call:

permissions:
  id-token: write
  contents: read

jobs:
  setup:
    name: Build
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - id: Auth
        uses: "google-github-actions/auth@v0"
        with:
          workload_identity_provider: "projects/424909584475/locations/global/workloadIdentityPools/github-actions/providers/github"
          service_account: "github-action@devbookhq.iam.gserviceaccount.com"

      - name: "Set up Cloud SDK"
        uses: "google-github-actions/setup-gcloud@v0"

      - name: Configure Docker
        run: |-
          gcloud --quiet auth configure-docker
