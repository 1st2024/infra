variable "kernel_path" {
  type = string
}

variable "rootfs_path" {
  type = string
}

variable "firecracker_path" {
  type = string
}

variable "gcp_zone" {
  type = string
}

job "firecracker-sessions" {
  datacenters = [var.gcp_zone]
  type = "batch"

  parameterized {}

  task "start" {
    driver = "firecracker-task-driver"

    resources {
      memory_max = 1024
      memory = 512
      cpu = 500
    }

    config {
      KernelImage = var.kernel_path
      BootDisk    = var.rootfs_path
      Firecracker = var.firecracker_path
      BootOptions = "console=ttyS0 noapic reboot=k panic=1 pci=off nomodules rw"
      Vcpus       = 1
      Mem         = 512
      Network     = "default"
    }
  }
}
